(function($){"use strict";var Palette=function(element,options){this.$element=$(element),this.options=$.extend({},$.fn.palette.defaults,options),this.$label=$(element).siblings("label"),this.palette_code='<div class="color-palette"></div>',this.visible=!1,this.init()};Palette.prototype={constructor:Palette,init:function(){this.$element.on("click",$.proxy(this.show,this))},show:function(event){var self=this;if(event.stopPropagation(),!this.visible){this.$element.after(this.palette_code);var palette=this.$element.siblings(".color-palette"),position=this.$element.position(),top=position.top+this.$element.height()+10,left=position.left;palette.click(function(event){event.stopPropagation()});for(var i=0;this.options.palette.length>i;i++)palette.append('<div class="palette-color" style="background-color:#'+this.options.palette[i]+'"></div>');palette.css({top:top,left:left}).fadeIn("fast"),this.visible=!0,$("html").click(function(){$(palette).fadeOut("fast",function(){$(palette).remove(),self.visible=!1})}),$(".palette-color").on("click",function(){var color=$(this).css("background-color");self.$element.css("color",color),self.$element.css("background-color",color),self.$element.attr("data-colorpicker-value",color),self.$element.val(color),$(palette).fadeOut("fast",function(){$(palette).remove(),self.visible=!1})})}}},$.fn.palette=function(options){return this.each(function(){var $this=$(this),data=$this.data("palette");data||$this.data("palette",data=new Palette(this,options))})},$.fn.palette.Constructor=Palette,$.fn.palette.defaults={palette:["fce94f","edd400","c4a000","fcaf3e","f57900","ce5c00","e9b96e","c17d11","8f5902","8ae234","73d216","4e9a06","729fcf","3465a4","204a87","ad7fa8","75507b","5c3566","ef2929","cc0000","a40000","888a85","555753","2e3436"]},$(document).ready(function(){$("input.palette").palette()})})(jQuery),function($){"use strict";function Validator(form,options,strategies){this.options=$.extend({},$.fn.validator.defaults,options),this.strategies=$.extend({},$.fn.validator.strategies,strategies),this.$form=$(form),this.$elements=jQuery(),this.init()}Validator.prototype={init:function(){var self=this;this.$elements=this.$form.find("input[data-validator]"),this.$form.find('input[data-validator-on="focus-loss"]').each(function(i,e){$(e).blur($.proxy(self.on_blur,self))}),this.$form.submit($.proxy(this.on_submit,this))},on_blur:function(event){this.validate_element($(event.target))},on_submit:function(event){var self=this;return $.each(this.$elements,function(index,element){self.validate_element($(element))}),this.$form.find("input."+self.options.error_class).length>0?(this.$form.attr("data-validation-result","not-valid"),event.preventDefault(),!1):!0},validate_element:function($element){var self=this,strategies=$element.attr("data-validator").split(" ");$.each(strategies,function(index,element_strategy){var strategy=self.strategies[element_strategy];if(void 0!==strategy){var message=strategy.check(self,$element);if(void 0!==message)return $element.hasClass(self.options.error_class)||$element.addClass(self.options.error_class),0==$element.siblings("div.error-message").length&&$element.after('<div class="error-message">'+message+"</div>"),!1;$element.removeClass(self.options.error_class),$element.siblings("div.error-message").remove()}})}},$.fn.validator=function(options,strategies){return this.each(function(){var $this=$(this),data=$this.data("validator"),opts=$.extend({},options),stgs=$.extend({},strategies);data||$this.data("validator",data=new Validator($this,opts,stgs))})},$.fn.validator.defaults={error_class:"error"},$.fn.validator.strategies={required:{check:function(self,$element){var type=$element.attr("type"),valid=!1;return"checkbox"===type?valid=$element.attr("checked"):("text"===type||"password"===type)&&(valid=$element.val().length>0),valid?void 0:"This field is required"}},email:{check:function(self,$element){var type=$element.attr("type"),valid=!1;return"text"===type&&(valid=/\S+@\S+\.\S+/.test($element.val())),valid?void 0:"This is not a valid email adress"}},password:{check:function(self,$element){var type=$element.attr("type"),valid=!1;if("password"===type){var text=$element.val();if(valid=text.length>5,!valid)return"Password needs to be more than 5 characters";if(valid=/(?=.*\d)/.test(text),!valid)return"Password needs to contain at least one digit";if(valid=/(?=.*[a-z])/.test(text),!valid)return"Password needs to contain at least one lower case character";if(valid=/(?=.*[A-Z])/.test(text),!valid)return"Password needs to contain at least one upper case character"}return void 0}},mirror:{check:function(self,$element){var mirror=$element.attr("data-validator-mirror");if(void 0!==mirror){var $mirror=self.$form.find("#"+mirror);if($element.val()!==$mirror.val())return"Not matching"}return void 0}},"color-hex":{check:function(self,$element){var type=$element.attr("type"),valid=!1;if("text"===type){var text=$element.val();if(valid=/^(#)?([0-9a-fA-F]{3})([0-9a-fA-F]{3})?$/.test(text),!valid)return"Must be a hex color code (e.g. #ffbbcc)"}return void 0}}},$.fn.validator.Constructor=Validator,$(function(){$("form[data-validation]").validator()})}(jQuery),function(e,t,n){"use strict";var r="function"==typeof e.moment,i=!!e.addEventListener,s=e.setTimeout,o=function(e,t,n,r){i?e.addEventListener(t,n,!!r):e.attachEvent("on"+t,n)},u=function(e,t,n,r){i?e.removeEventListener(t,n,!!r):e.detachEvent("on"+t,n)},a=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},f=function(e,t){return-1!==(" "+e.className+" ").indexOf(" "+t+" ")},l=function(e,t){f(e,t)||(e.className=""===e.className?t:e.className+" "+t)},c=function(e,t){e.className=a((" "+e.className+" ").replace(" "+t+" "," "))},h=function(e){return/Array/.test(Object.prototype.toString.call(e))},p=function(e){return/Date/.test(Object.prototype.toString.call(e))&&!isNaN(e.getTime())},d=function(e){return 0===e%4&&0!==e%100||0===e%400},v=function(e,t){return[31,d(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},m=function(e,t){return e.getTime()===t.getTime()},g=function(e,t,r){var i,s;for(i in t)s=e[i]!==n,s&&"object"==typeof t[i]&&t[i].nodeName===n?p(t[i])?r&&(e[i]=new Date(t[i].getTime())):h(t[i])?r&&(e[i]=t[i].slice(0)):e[i]=g({},t[i],r):(r||!s)&&(e[i]=t[i]);return e},y={field:null,bound:n,format:"YYYY-MM-DD",defaultDate:null,setDefaultDate:!1,firstDay:0,minDate:null,maxDate:null,yearRange:10,minYear:0,maxYear:9999,minMonth:n,maxMonth:n,isRTL:!1,numberOfMonths:1,i18n:{months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},onSelect:null,onOpen:null,onClose:null},b=function(e,t,n){for(t+=e.firstDay;t>=7;)t-=7;return n?e.i18n.weekdaysShort[t]:e.i18n.weekdays[t]},w=function(e,t,n,r,i){if(i)return'<td class="is-empty"></td>';var s=[];return r&&s.push("is-disabled"),n&&s.push("is-today"),t&&s.push("is-selected"),'<td data-day="'+e+'" class="'+s.join(" ")+'"><button class="pika-button" type="button">'+e+"</button>"+"</td>"},E=function(e,t){return"<tr>"+(t?e.reverse():e).join("")+"</tr>"},S=function(e){return"<tbody>"+e.join("")+"</tbody>"},x=function(e){var t,n=[];for(t=0;7>t;t++)n.push('<th scope="col"><abbr title="'+b(e,t)+'">'+b(e,t,!0)+"</abbr></th>");return"<thead>"+(e.isRTL?n.reverse():n).join("")+"</thead>"},T=function(e){var t,n,r,i=e._o,s=e._m,o=e._y,u=o===i.minYear,a=o===i.maxYear,f='<div class="pika-title">',l=!0,c=!0;for(r=[],t=0;12>t;t++)r.push('<option value="'+t+'"'+(t===s?" selected":"")+(u&&i.minMonth>t||a&&t>i.maxMonth?"disabled":"")+">"+i.i18n.months[t]+"</option>");for(f+='<div class="pika-label">'+i.i18n.months[s]+'<select class="pika-select pika-select-month">'+r.join("")+"</select></div>",h(i.yearRange)?(t=i.yearRange[0],n=i.yearRange[1]+1):(t=o-i.yearRange,n=1+o+i.yearRange),r=[];n>t&&i.maxYear>=t;t++)t>=i.minYear&&r.push('<option value="'+t+'"'+(t===o?" selected":"")+">"+t+"</option>");return f+='<div class="pika-label">'+o+'<select class="pika-select pika-select-year">'+r.join("")+"</select></div>",u&&(0===s||i.minMonth>=s)&&(l=!1),a&&(11===s||s>=i.maxMonth)&&(c=!1),f+='<button class="pika-prev'+(l?"":" is-disabled")+'" type="button">Previous Month</button>',f+='<button class="pika-next'+(c?"":" is-disabled")+'" type="button">Next Month</button>',f+="</div>"},N=function(e,t){return'<table cellpadding="0" cellspacing="0" class="pika-table">'+x(e)+S(t)+"</table>"};e.Pikaday=function(n){var u=this,a=u.config(n);u._onMouseDown=function(t){if(u._v){t=t||e.event;var n=t.target||t.srcElement;if(n){if(!f(n,"is-disabled")){if(f(n,"pika-button")&&!f(n,"is-empty"))return u.setDate(new Date(u._y,u._m,parseInt(n.innerHTML,10))),a.bound&&s(function(){u.hide()},100),void 0;f(n,"pika-prev")?u.prevMonth():f(n,"pika-next")&&u.nextMonth()}if(f(n,"pika-select"))u._c=!0;else{if(!t.preventDefault)return t.returnValue=!1;t.preventDefault()}}}},u._onChange=function(t){t=t||e.event;var n=t.target||t.srcElement;n&&(f(n,"pika-select-month")?u.gotoMonth(n.value):f(n,"pika-select-year")&&u.gotoYear(n.value))},u._onInputChange=function(){if(r)u.setDate(e.moment(a.field.value,a.format).toDate());else{var n=new Date(Date.parse(a.field.value));u.setDate(p(n)?n:null)}u._v||u.show()},u._onInputFocus=function(){u.show()},u._onInputClick=function(){u.show()},u._onInputBlur=function(){u._c||(u._b=s(function(){u.hide()},50)),u._c=!1},u._onClick=function(t){t=t||e.event;var n=t.target||t.srcElement,r=n;if(n){!i&&f(n,"pika-select")&&(n.onchange||(n.setAttribute("onchange","return;"),o(n,"change",u._onChange)));do if(f(r,"pika-single"))return;while(r=r.parentNode);u._v&&n!==a.field&&u.hide()}},u.el=t.createElement("div"),u.el.className="pika-single"+(a.isRTL?" is-rtl":""),o(u.el,"mousedown",u._onMouseDown,!0),o(u.el,"change",u._onChange),a.field&&(a.bound?t.body.appendChild(u.el):a.field.parentNode.insertBefore(u.el,a.field.nextSibling),o(a.field,"change",u._onInputChange),a.defaultDate||(a.defaultDate=r&&a.field.value?e.moment(a.field.value,a.format).toDate():new Date(Date.parse(a.field.value)),a.setDefaultDate=!0));var l=a.defaultDate;p(l)?a.setDefaultDate?u.setDate(l):u.gotoDate(l):u.gotoDate(new Date),a.bound?(this.hide(),u.el.className+=" is-bound",o(a.field,"click",u._onInputClick),o(a.field,"focus",u._onInputFocus),o(a.field,"blur",u._onInputBlur)):this.show()},e.Pikaday.prototype={config:function(e){this._o||(this._o=g({},y,!0));var t=g(this._o,e,!0);t.isRTL=!!t.isRTL,t.field=t.field&&t.field.nodeName?t.field:null,t.bound=!!(t.bound!==n?t.field&&t.bound:t.field);var r=parseInt(t.numberOfMonths,10)||1;if(t.numberOfMonths=r>4?4:r,p(t.minDate)||(t.minDate=!1),p(t.maxDate)||(t.maxDate=!1),t.minDate&&t.maxDate&&t.maxDate<t.minDate&&(t.maxDate=t.minDate=!1),t.minDate&&(t.minYear=t.minDate.getFullYear(),t.minMonth=t.minDate.getMonth()),t.maxDate&&(t.maxYear=t.maxDate.getFullYear(),t.maxMonth=t.maxDate.getMonth()),h(t.yearRange)){var i=(new Date).getFullYear()-10;t.yearRange[0]=parseInt(t.yearRange[0],10)||i,t.yearRange[1]=parseInt(t.yearRange[1],10)||i}else t.yearRange=Math.abs(parseInt(t.yearRange,10))||y.yearRange,t.yearRange>100&&(t.yearRange=100);return t},toString:function(t){return p(this._d)?r?e.moment(this._d).format(t||this._o.format):this._d.toDateString():""},getMoment:function(){return r?e.moment(this._d):null},getDate:function(){return p(this._d)?new Date(this._d.getTime()):null},setDate:function(e){if(!e)return this._d=null,this.draw();if("string"==typeof e&&(e=new Date(Date.parse(e))),p(e)){var t=this._o.minDate,n=this._o.maxDate;p(t)&&t>e?e=t:p(n)&&e>n&&(e=n),this._d=new Date(e.getTime()),this._d.setHours(0,0,0,0),this.gotoDate(this._d),this._o.field&&(this._o.field.value=""+this),"function"==typeof this._o.onSelect&&this._o.onSelect.call(this,this.getDate())}},gotoDate:function(e){p(e)&&(this._y=e.getFullYear(),this._m=e.getMonth(),this.draw())},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(e){isNaN(e=parseInt(e,10))||(this._m=0>e?0:e>11?11:e,this.draw())},nextMonth:function(){++this._m>11&&(this._m=0,this._y++),this.draw()},prevMonth:function(){0>--this._m&&(this._m=11,this._y--),this.draw()},gotoYear:function(e){isNaN(e)||(this._y=parseInt(e,10),this.draw())},draw:function(e){if(this._v||e){var t=this._o,n=t.minYear,r=t.maxYear,i=t.minMonth,o=t.maxMonth;if(n>=this._y&&(this._y=n,!isNaN(i)&&i>this._m&&(this._m=i)),this._y>=r&&(this._y=r,!isNaN(o)&&this._m>o&&(this._m=o)),this.el.innerHTML=T(this)+this.render(this._y,this._m),t.bound){for(var u=t.field,a=u.offsetLeft,f=u.offsetTop+u.offsetHeight;u=u.offsetParent;)a+=u.offsetLeft,f+=u.offsetTop;this.el.style.cssText="position:absolute;left:"+a+"px;top:"+f+"px;",s(function(){t.field.focus()},1)}}},render:function(e,t){var n=this._o,r=new Date,i=v(e,t),s=new Date(e,t,1).getDay(),o=[],u=[];r.setHours(0,0,0,0),n.firstDay>0&&(s-=n.firstDay,0>s&&(s+=7));for(var a=i+s,f=a;f>7;)f-=7;a+=7-f;for(var l=0,c=0;a>l;l++){var h=new Date(e,t,1+(l-s)),d=n.minDate&&n.minDate>h||n.maxDate&&h>n.maxDate,g=p(this._d)?m(h,this._d):!1,y=m(h,r),b=s>l||l>=i+s;u.push(w(1+(l-s),g,y,d,b)),7===++c&&(o.push(E(u,n.isRTL)),u=[],c=0)}return N(n,o)},isVisible:function(){return this._v},show:function(){this._v||(this._o.bound&&o(t,"click",this._onClick),c(this.el,"is-hidden"),this._v=!0,this.draw(),"function"==typeof this._o.onOpen&&this._o.onOpen.call(this))},hide:function(){var e=this._v;e!==!1&&(this._o.bound&&u(t,"click",this._onClick),this.el.style.cssText="",l(this.el,"is-hidden"),this._v=!1,e!==n&&"function"==typeof this._o.onClose&&this._o.onClose.call(this))},destroy:function(){this.hide(),u(this.el,"mousedown",this._onMouseDown,!0),u(this.el,"change",this._onChange),this._o.field&&(u(this._o.field,"change",this._onInputChange),this._o.bound&&(u(this._o.field,"click",this._onInputClick),u(this._o.field,"focus",this._onInputFocus),u(this._o.field,"blur",this._onInputBlur))),this.el.parentNode&&this.el.parentNode.removeChild(this.el)}}}(window,window.document),function(){"use strict";function Quarterapp(){this.current_activity={id:-1,color:"#fff",title:"Not working"},this.current_date=void 0,this.pending_update=!1,this.init()}Quarterapp.prototype={constructor:Quarterapp,activity_markup:'<div class="activity-module" data-activity-id="{0}"><div class="activity-color" data-palette-value="{2}"><input class="palette" type="text" value="" style="background-color: {2};" disabled /></div><div class="activity-title">{1}</div><div class="activity-edit-title"><input type="text" value="{1}" /></div><div class="activity-control activity-edit-control"><a href="#" title="Edit"><span>&nbsp;</span></a></div><div class="activity-control activity-save-control"><a href="#" title="Save"><span>&nbsp;</span></a></div><div class="activity-control activity-cancel-control"><a  href="#" title="Cancel"><span>&nbsp;</span></a></div><div class="activity-control activity-delete-control"><a href="#" title="Delete"><span>&nbsp;</span></a></div></div>',summary_markup:'<tr data-activity-id="{0}" style="color: {1};"><td class="value">{2}</td><td class="activity">{3}</td></tr>',init:function(){if($("#create-activity").submit($.proxy(this.on_create_activity,this)),$("div.activity-edit-control > a").click($.proxy(this.on_edit_activity,this)),$("div.activity-cancel-control > a").click($.proxy(this.on_cancel_activity,this)),$("div.activity-save-control > a").click($.proxy(this.on_save_activity,this)),$("div.activity-delete-control > a").click($.proxy(this.on_delete_activity,this)),$("#datepicker").length>0){var current_date=$("#sheet").attr("data-sheet-date");this.current_date=new Date(current_date),new Pikaday({field:document.getElementById("datepicker"),firstDay:1,defaultDate:this.current_date,setDefaultDate:!0,onSelect:$.proxy(this.on_select_date,this)})}$("#current-activity").click($.proxy(this.on_toggle_activity_selector,this)),$("#available-activities div.activity").on("click",$.proxy(this.on_select_activity,this)),$("table.sheet tr").slice(0,6).hide(),$("table.sheet tr").slice(18,24).hide(),$("#extend-sod").click($.proxy(this.on_extend_sod,this)),$("#extend-eod").click($.proxy(this.on_extend_eod,this)),$("table.sheet td").bind("mousedown",$.proxy(this.on_sheet_mouse_down,this)),$("table.sheet td").bind("mousemove",$.proxy(this.on_sheet_mouse_move,this)),$("body").bind("mouseup",$.proxy(this.on_sheet_mouse_up,this)),$("#delete-account").click($.proxy(this.on_show_delete_account,this));var activity=this.get_preferred_activity();this.set_current_activity(activity),this.show_sheets_activities()},log:function(msg){void 0!==console.log&&console.log(msg)},show_error:function(title,message){$("#main-region").prepend('<div class="error box"><section class="content"><h3>{0}</h3><p>{1}</p><a class="dismiss" href="#" title="Dismiss" data-dismiss-action>dismiss</a></section></div>'.format(title,message)),$("a.dismiss").bind("click",$.proxy(this.on_dismiss_error,this))},on_dismiss_error:function(){var $element=$(event.target);$element.parents("div.error.box").fadeOut(300,function(){$(this).remove()})},to_date_string:function(date){var month=""+(date.getMonth()+1);1===month.length&&(month="0"+month);var day=""+date.getDate();return 1===day.length&&(day="0"+day),"{0}-{1}-{2}".format(date.getFullYear(),month,day)},luminance:function(hex,lum){try{hex=(hex+"").replace(/[^0-9a-f]/gi,""),6>hex.length&&(hex=hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2]),lum=lum||0;var c,i,rgb="#";for(i=0;3>i;i++)c=parseInt(hex.substr(2*i,2),16),c=Math.round(Math.min(Math.max(0,c+c*lum),255)).toString(16),rgb+=("00"+c).substr(c.length);return rgb}catch(e){return hex}},set_preferred_activity:function(activity){"undefined"!=typeof localStorage&&(localStorage.setItem("quarter-activity-id",activity.id),localStorage.setItem("quarter-activity-title",activity.title),localStorage.setItem("quarter-activity-color",activity.color))},get_preferred_activity:function(){return"undefined"!=typeof localStorage?{id:localStorage.getItem("quarter-activity-id"),title:localStorage.getItem("quarter-activity-title"),color:localStorage.getItem("quarter-activity-color")}:this.current_activity},show_sheets_activities:function(){for(var $early_rows=$("table.sheet tbody tr").slice(0,11),$late_rows=$("table.sheet tbody tr").slice(12,24),found_it=!1,process_row=function(){return found_it===!0?($current_row.show(),!0):!$current_row.is(":visible")&&$current_row.find("span[data-activity-id!='-1']").length>0?($current_row.show(),!0):void 0},i=0;$early_rows.length>i;i++){var $current_row=$early_rows.eq(i);found_it=process_row($current_row,found_it)}for(var i=$late_rows.length-1;i>-1;i--){var $current_row=$late_rows.eq(i);found_it=process_row($current_row,found_it)}},on_create_activity:function(event){var self=this,$form=$(event.target);if(event.preventDefault(),"not-valid"!=$form.attr("data-validation-result")){var data=$form.serialize();$.ajax({url:$form.attr("action"),type:$form.attr("method"),data:data,success:function(data){$form.find("input").val(""),$form.find("div.error-message").remove();var new_activity=self.activity_markup.format(data.activity.id,data.activity.title,data.activity.color);$("[data-activity-list]").append(new_activity)},error:function(){0===$form.find("div.error-message").length&&$form.append('<div class="error-message note"><p>Could not create activity!</p></div>')}})}},on_edit_activity:function(event){var $module=$(event.target).parents("[data-activity-id]");if($module.length>0){var id=$module.attr("data-activity-id");$("[data-activity-id='"+id+"']").addClass("edit"),$module.find("input.palette").prop("disabled",!1)}return!1},on_cancel_activity:function(){var $module=$(event.target).parents("[data-activity-id]");if($module.length>0){var id=$module.attr("data-activity-id"),title=$module.find("div.activity-title").text(),color=$module.find("div.activity-color[data-palette-value]").attr("data-palette-value");$module.find("div.activity-edit-title > input").val(title),$module.find("input.palette").css("background-color",color),$("[data-activity-id='"+id+"']").removeClass("edit"),$module.find("input.palette").prop("disabled",!0)}return!1},on_save_activity:function(){var $module=$(event.target).parents("[data-activity-id]");if($module.length>0){var id=$module.attr("data-activity-id"),title=$module.find("div.activity-edit-title > input").val(),color=$module.find("input.palette").css("background-color");$.ajax({url:"/api/activity/"+id,type:"PUT",data:{title:title,color:color},success:function(){$module.find("div.activity-title").text(title),$module.find("div.activity-color[data-palette-value]").attr("data-palette-value",color),$("[data-activity-id='"+id+"']").removeClass("edit")},error:function(){quarterapp.show_error("Oops","Could not save activity!")}})}return!1},on_delete_activity:function(){var $module=$(event.target).parents("[data-activity-id]");if($module.length>0){var id=$module.attr("data-activity-id");$.ajax({url:"/api/activity/"+id,type:"DELETE",success:function(){$module.remove()},error:function(){quarterapp.show_error("Oops","Could not delete activity!")}})}return!1},on_select_date:function(date){if(date.getFullYear()!==this.current_date.getFullYear()||date.getMonth()!==this.current_date.getMonth()||date.getDate()!==this.current_date.getDate()){var location="/sheet/"+this.to_date_string(date);window.location=location}},on_toggle_activity_selector:function(){$("#available-activities").toggle()},on_select_activity:function(event){var $element=$(event.target).parents("div.activity"),new_id=$element.attr("data-activity-id"),new_color=$element.attr("data-activity-color"),new_title=$element.attr("data-activity-title");void 0!==new_id&&void 0!==new_color&&void 0!==new_title&&this.set_current_activity({id:new_id,color:new_color,title:new_title}),$("#available-activities").hide()},set_current_activity:function(activity){if($('div.activity[data-activity-id="'+activity.id+'"]').length>0){this.current_activity=activity;var $current_activity=$("#current-activity");$current_activity.find("input.palette").css("background-color",activity.color),$current_activity.find("div.activity-title").text(activity.title),this.set_preferred_activity(activity)}},on_extend_sod:function(){for(var $rows=$("table.sheet tbody tr").slice(0,11),i=$rows.length-1;i>-1;i--)if(!$rows.eq(i).is(":visible"))return $rows.eq(i).show(),void 0},on_extend_eod:function(){for(var $rows=$("table.sheet tbody tr").slice(12,24),i=0;$rows.length>i;i++)if(!$rows.eq(i).is(":visible"))return $rows.eq(i).show(),void 0},paint_cell:function($activity_cell){var activity_id=$activity_cell.attr("data-activity-id");void 0!==activity_id&&void 0===$activity_cell.attr("data-activity-previous-id")&&($activity_cell.attr("data-activity-previous-id",activity_id),$activity_cell.attr("data-activity-previous-color",$activity_cell.css("background-color")),$activity_cell.attr("data-activity-id",this.current_activity.id),$activity_cell.css("background-color",this.current_activity.color),$activity_cell.css("border-color",this.luminance(this.current_activity.color,-.2)),$activity_cell.addClass("pending"))},on_sheet_mouse_down:function(event){1===event.which&&(this.pending_update=!0,this.paint_cell($(event.target)))},on_sheet_mouse_move:function(event){1===event.which&&this.pending_update&&this.paint_cell($(event.target))},on_sheet_mouse_up:function(event){function cleanup_pending_activities(){var $activities=$("table.sheet span.activity-cell.pending");$activities.removeAttr("data-activity-previous-id"),$activities.removeAttr("data-activity-previous-color"),$activities.removeClass("pending")}if(1===event.which&&this.pending_update){var self=this,quarters=[];if($("table.sheet span.activity-cell").each(function(index,cell){quarters.push($(cell).attr("data-activity-id"))}),96!==quarters.length)return quarterapp.show_error("Oops","Sheet is broken, try to refresh the page."),void 0;quarters+="",$.ajax({url:"/api/sheet/"+self.to_date_string(self.current_date),type:"PUT",data:{quarters:quarters},success:function(data){var summary_total=$("#summary-hours"),summary_table=$("#sheet-summary");summary_total.html(new Number(data.total).toFixed(2)),summary_table.empty(),summary_table.append("<tbody></tbody>"),$.each(data.summary,function(index,act){var ac=self.summary_markup.format(act.id,act.color,new Number(act.sum).toFixed(2),act.title);summary_table.append(ac)})},error:function(){$("table.sheet span.activity-cell.pending"),$("table.sheet span.activity-cell.pending").each(function(index,element){var $element=$(element);$element.attr("data-activity-id",$element.attr("data-activity-previous-id"));var activity_color=$element.attr("data-activity-previous-color");$element.css("background-color",activity_color),$element.css("border-color",self.luminance(activity_color,-.2))})}}),cleanup_pending_activities(),this.pending_update=!1}},on_show_delete_account:function(){$("#delete-account-form").show()}},window.quarterapp=new Quarterapp}(),void 0===String.prototype.format&&(String.prototype.format=function(){for(var formatted=this,i=0;arguments.length>i;i++){var regexp=RegExp("\\{"+i+"\\}","gi");formatted=formatted.replace(regexp,arguments[i])}return formatted}),$.cssHooks.backgroundColor={get:function(elem){function hex(x){return("0"+parseInt(x).toString(16)).slice(-2)}if(elem.currentStyle)var bg=elem.currentStyle.backgroundColor;else if(window.getComputedStyle)var bg=document.defaultView.getComputedStyle(elem,null).getPropertyValue("background-color");return-1==bg.search("rgb")?bg:(bg=bg.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),"#"+hex(bg[1])+hex(bg[2])+hex(bg[3]))}},function($){"use strict";function Admin(){}Admin.prototype={constructor:Admin,disable_user:function(element){var $element=$(element);$.ajax({url:$element.attr("href"),type:"POST",success:function(){$element.html("enable"),$element.attr("href",$element.attr("href").replace("disable","enable")),$element.attr("onclick",$element.attr("onclick").replace("disable_user","enable_user"))},error:function(){quarterapp.show_error("Oops","Could not disable user!")}})},enable_user:function(element){var $element=$(element);$.ajax({url:$element.attr("href"),type:"POST",success:function(){$element.html("disable"),$element.attr("href",$element.attr("href").replace("enable","disable")),$element.attr("onclick",$element.attr("onclick").replace("enable_user","disable_user"))},error:function(){quarterapp.show_error("Oops","Could not enable user!")}})},delete_user:function(element){$.ajax({url:element.href,type:"POST",success:function(){$(element).parents("tr").remove()},error:function(){quarterapp.show_error("Oops","Could not delete user!")}})},clear_filter:function(){$("#filter").val("")},toggle_setting:function(element){var $element=$(element),checked=$element.attr("checked");$.ajax({url:"/admin/settings/"+$element.attr("id"),type:"POST",data:{value:void 0==checked?0:1},success:function(){$element.prop("checked",checked?!0:!1)},error:function(){var $desc=$element.parent(".setting-control").siblings(".setting-description");0==$desc.find("div.error-message").length&&$desc.append('<div class="error-message">Could not change setting!</div>')}})}},void 0===window.quarterapp?console.log("Oops, admin script must load after main quarterapp.js"):window.quarterapp.admin=new Admin}(jQuery);